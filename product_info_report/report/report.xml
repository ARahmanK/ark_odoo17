<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_product_detailed_template">
        <t t-call="web.html_container">
            <t t-call="product_info_report.custom_external_layout">
                <div class="page">
                    <div class="container">
                        <div class="oe_structure"/>
                        <div class="row heading text-center" style="page-break-after:always;">
                            <h3>Products Detail Report</h3>
                        </div>
                        <t t-if="products">
                            <t t-set="product_rows" t-value="[products[i:i+3] for i in range(0, len(products), 3)]"/>
                            <t t-set="row_no" t-value="0"/>
                            <t t-foreach="product_rows" t-as="row">
                                <t t-set="row_no" t-value="row_no + 1"/>
                                <div class="row mt8">
                                    <t t-foreach="row" t-as="product">
                                        <t t-set="product_id"
                                           t-value="request.env['product.product'].search([('id','=',product.get('id'))])"/>
                                        <div class="col-4 mx-1" style="border:2px solid #2ea34b;">
                                            <div class="text-center m-2"
                                                 style="width: 260pt;height: 260pt;">
                                                <span t-field="product_id.image_1920" t-options='{"widget": "image"}'/>
                                            </div>
                                            <div class="row text-center justify-content-center align-items-center d-flex"
                                                 style="border:1px solid #2ea34b;">
                                                <div class="col-4">
                                                    <span>
                                                        <strong>
                                                            <span t-if="product_id.currency_id.position == 'before'"
                                                                  t-field="product_id.currency_id.symbol"/>
                                                            <t t-esc="'%.2f' % product_id.lst_price"/>
                                                            <span t-if="product_id.currency_id.position == 'after'"
                                                                  t-field="product_id.currency_id.symbol"/>
                                                        </strong>
                                                    </span>
                                                </div>
                                                <div class="col-4" style="border-left:1px solid #2ea34b;">
                                                    <span>
                                                        <t t-if="product_id.packaging_ids">
                                                            <t t-set="pack_price"
                                                               t-value="product_id.lst_price * product_id.packaging_ids[0].qty"/>
                                                            <strong>
                                                                <span t-if="product_id.currency_id.position == 'before'"
                                                                  t-field="product_id.currency_id.symbol"/>
                                                                <t t-esc="'%.2f' % pack_price"/>
                                                                <span t-if="product_id.currency_id.position == 'after'"
                                                                  t-field="product_id.currency_id.symbol"/>
                                                            </strong>
                                                        </t>
                                                        <t t-else="">
                                                            <span>
                                                                <strong>No Pack</strong>
                                                            </span>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="col-4"
                                                     style="border:1px solid #2ea34b;background-color: #2ea34b;">
                                                    <span>
                                                        <strong>
                                                            <t t-esc="product_id.default_code"/>
                                                        </strong>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="row text-center">
                                                <div class="col-12">
                                                    <t t-if="'Free Product' in product_id.name">
                                                        <span t-esc="product_id.name.split('Free Product ')[1]"/>
                                                    </t>
                                                    <span t-else="" t-field="product_id.name"/>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                <t t-if="row_no == 3">
                                    <div class="" style="page-break-after:always;"></div>
                                    <t t-set="row_no" t-value="0"/>
                                </t>
                            </t>
                        </t>
                    </div>
                </div>
            </t>
        </t>
    </template>


    <template id="custom_external_layout">
        <t t-if="not o" t-set="o" t-value="doc"/>

        <t t-if="not company">
            <!-- Multicompany -->
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="else">
                <t t-set="company" t-value="res_company"/>
            </t>
        </t>

        <t t-call="product_info_report.custom_external_layout_standard">
            <t t-out="0"/>
        </t>

    </template>


    <template id="custom_external_layout_standard">
        <div t-attf-class="header o_company_#{company.id}_layout" t-att-style="report_header_style">
            <div class="row mx-4" style="">
                <div class="col-6 text-left">
                    <img t-if="company.logo" t-att-src="image_data_uri(company.logo)"
                         style="max-height: 130pt;"
                         alt="Logo"/>
                </div>
                <div class="col-6 text-right p-1" style="font-size: 22px;text-align:right; align-items:right;">
                    <strong>
                        <span t-field="company.name"/>
                    </strong>
                    <br/>
                    <span t-field="company.street"/>, <span t-field="company.city"/>, <span t-field="company.state_id"/>, <span t-field="company.zip"/>, <span t-field="company.country_id.code"/>
                    <br/>
                    <br/>
                    <strong>
                        <span>
                            <span t-field="company.phone"/>
                            |
                            <span t-field="company.email"/>
                            |
                            <br/>
                            <span t-field="company.website"/>
                        </span>
                    </strong>
                </div>
            </div>
        </div>

        <div t-attf-class="article o_report_layout_standard o_company_#{company.id}_layout {{  'o_report_layout_background' if company.layout_background in ['Geometric', 'Custom']  else  '' }}"
             t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % company.layout_background_image.decode('utf-8') if company.layout_background_image and company.layout_background == 'Custom' else '/base/static/img/bg_background_template.jpg' if company.layout_background == 'Geometric' else ''}});"
             t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id"
             t-att-data-oe-lang="o and o.env.context.get('lang')">
            <div class="pt-5">
                <t t-call="web.address_layout"/>
            </div>
            <t t-out="0"/>
        </div>
        <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
            <div class="text-center" style="border-top: 1px solid black;">
                <ul class="list-inline mb4">
                    <div t-field="company.report_footer"/>
                </ul>

                <div t-if="report_type == 'pdf'" class="text-muted">
                    Page:
                    <span class="page"/>
                    /
                    <span class="topage"/>
                </div>
                <div t-if="report_type == 'pdf' and display_name_in_footer" class="text-muted">
                    <span t-out="o.name">(document name)</span>
                </div>
            </div>
        </div>
    </template>
</odoo>
